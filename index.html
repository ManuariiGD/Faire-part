<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enveloppe interactive responsive</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background-image: url('fond.jpg');
    background-size: cover;
    background-position: center;
    font-family: sans-serif;
    overflow: hidden;
  }

  .enveloppe-container {
    perspective: 1200px;
    width: 80vw;   /* largeur relative */
    max-width: 600px;
  }

  .enveloppe {
    width: 100%;
    aspect-ratio: 486 / 348; /* garde les proportions */
    position: relative;
    transform-style: preserve-3d;
    transition: transform 1s ease-in-out;
    cursor: pointer;
  }

  .enveloppe.flipped {
    transform: rotateY(180deg);
  }

  .face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    overflow: visible;
  }

  .recto, .verso {
    background-color: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .verso {
    transform: rotateY(180deg);
  }

  .face img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* --- Rabat --- */
  .rabat_container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    perspective: 800px;
    pointer-events: none;
  }

  .rabat {
    width: 100%;
    height: 100%;
    position: absolute;
    transform-style: preserve-3d;
    transform-origin: top center;
    transition: transform 1s ease-in-out;
  }

  .rabat.flipped {
    transform: rotateX(-180deg);
  }

  .rabat .face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
  }

  .rabat .verso {
    transform: rotateX(-180deg);
  }

  .absolute {
    position: absolute;
    width: 100%;
    height: 100%;
  }

  /* --- Carte --- */
  .carte_container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    perspective: 800px;
    pointer-events: none;
  }

  .carte {
    width: 100%;
    height: 100%;
    position: absolute;
    transform-style: preserve-3d;
    transition: transform 1s ease-in-out;
  }

  /* --- animation d’entrée (1er clic) --- */
  @keyframes entree {
    0%   { transform: translateY(0) rotateZ(0deg) scale(1); }
    25%  { transform: translateY(-25vh) rotateZ(0deg) scale(1); }
    50%  { transform: translateY(-25vh) rotateZ(90deg) scale(1); }
    75%  { transform: translate(0, -50%) rotateZ(90deg) scale(1.1); }
    100% { transform: translate(0, -50%) rotateZ(90deg) scale(1.4); }
  }

  .entree {
    animation: entree 4s ease forwards;
  }

  .flipped {
    transform: rotateY(180deg);
  }
</style>
</head>
<body>

<div class="enveloppe-container">
  <div id="overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; perspective: 1200px;"></div>
  <div class="enveloppe" id="enveloppe">
    <div class="face recto">
      <img src="recto.png" alt="Recto">
    </div>
    <div class="face verso">
      <img class="absolute" src="verso_marron.png" alt="Verso marron">
      <div class="carte_container">
        <div class="carte" id="carte">
          <div class="face recto">
            <img src="carte_recto.png" alt="Carte recto">
          </div>
          <div class="face verso">
            <img src="carte_verso.png" alt="Carte verso">
          </div>
        </div>
      </div>
      <img class="absolute" src="verso_vert.png" alt="Verso vert">
      <div class="rabat_container">
        <div class="rabat" id="rabat">
          <div class="face recto">
            <img src="rabat_ferme.png" alt="Rabat fermé">
          </div>
          <div class="face verso">
            <img src="rabat_ouvert.png" alt="Rabat ouvert">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const enveloppe = document.getElementById('enveloppe');
  const rabat = document.getElementById('rabat');
  const carte = document.getElementById('carte');
  const overlay = document.getElementById('overlay');
  let clickCount = 0;
  let flipped = false;

  enveloppe.addEventListener('click', () => {
    clickCount++;

    if (clickCount === 1) {
      enveloppe.classList.add('flipped');
    } else if (clickCount === 2) {
      rabat.classList.add('flipped');
    } else if (clickCount === 3) {
      const carteClone = carte.cloneNode(true);
      carteClone.id = 'carteClone';
      carteClone.style.position = 'absolute';

      // Position relative à l'overlay
      const carteRect = carte.getBoundingClientRect();
      const overlayRect = overlay.getBoundingClientRect();
      carteClone.style.top = (carteRect.top - overlayRect.top) + 'px';
      carteClone.style.left = (carteRect.left - overlayRect.left) + 'px';

      carteClone.style.width = carte.offsetWidth + 'px';
      carteClone.style.height = carte.offsetHeight + 'px';
      carteClone.style.transition = 'transform 1s ease-in-out';
      carteClone.classList.add('entree');

      overlay.appendChild(carteClone);

      carteClone.addEventListener('animationend', () => {
        carteClone.classList.remove('entree');
        carteClone.style.transform = 'translate(0, -50%) rotateZ(90deg) scale(1.4)';
      }, { once: true });

      carte.style.opacity = 0;
    } else if (clickCount > 3) {
      const carteClone = document.getElementById('carteClone');
      if (!carteClone) return;
      flipped = !flipped;
      const baseTransform = 'translate(0, -50%) rotateZ(90deg) scale(1.4)';
      carteClone.style.transform = flipped ? baseTransform + ' rotateY(180deg)' : baseTransform;
    }
  });
</script>

</body>
</html>
